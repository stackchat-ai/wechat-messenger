"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _dec,_class,_class2,_temp2,_createClass=function(){function i(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e}}(),_get=function e(t,a,i){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,a);if(void 0===s){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,a,i)}if("value"in s)return s.value;var o=s.get;return void 0!==o?o.call(i):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../../npm/@tarojs/redux/index.js"),_index4=require("../../../npm/date-fns/difference_in_seconds/index.js"),_index5=_interopRequireDefault(_index4);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var BASE_CLASS_NAME="sc-message-status-indicator",MINUTE=60,HOUR=3600,DAY=86400,MessageStatusIndicator=(_dec=(0,_index3.connect)(function(e){var t=e.ui.text;return{text:{messageRelativeTimeDay:t.messageRelativeTimeDay,messageRelativeTimeHour:t.messageRelativeTimeHour,messageRelativeTimeJustNow:t.messageRelativeTimeJustNow,messageRelativeTimeMinute:t.messageRelativeTimeMinute,messageSending:t.messageSending,messageDelivered:t.messageDelivered}}}))((_temp2=_class2=function(){function o(){var e,t,a;_classCallCheck(this,o);for(var i=arguments.length,s=Array(i),n=0;n<i;n++)s[n]=arguments[n];return(t=a=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(s)))).$usedState=["anonymousState__temp","BASE_CLASS_NAME","seen","timeDisplay","delivered","timeIndicator","updateTimeout","value","text","isAppUser","appMakerHasRead"],a.state={timeIndicator:a.getTimeData().text,updateTimeout:null},a.customComponents=[],_possibleConstructorReturn(a,t)}return _inherits(o,_index.Component),_createClass(o,[{key:"_constructor",value:function(e){_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_constructor",this).call(this,e),this.$$refs=[]}},{key:"handleTimeUpdate",value:function(){var e=this,t=this.getTimeData(),a=t.text,i=t.difference;if(clearTimeout(this.state.updateTimeout),this.setState({timeIndicator:a,updateTimeout:null}),a){var s=void 0;s=i<HOUR?MINUTE:i<DAY?HOUR:DAY;var n=setTimeout(function(){e.handleTimeUpdate()},1e3*s);this.setState({updateTimeout:n})}}},{key:"getTimeData",value:function(){var e=this.props,t=e.value,a=e.text,i=a.messageRelativeTimeDay,s=a.messageRelativeTimeHour,n=a.messageRelativeTimeJustNow,o=a.messageRelativeTimeMinute,r=new Date(1e3*t),u=(0,_index5.default)(new Date,r),l=void 0;return u<MINUTE?l=n:u<HOUR?l=o.replace("{value}",Math.round(u/MINUTE).toFixed()):u<DAY?l=s.replace("{value}",Math.round(u/HOUR).toFixed()):u<=604800?l=i.replace("{value}",Math.round(u/DAY).toFixed()):t&&(l=""),{text:l,difference:u}}},{key:"componentDidMount",value:function(){this.handleTimeUpdate()}},{key:"componentWillUnmount",value:function(){this.state.updateTimeout&&clearTimeout(this.state.updateTimeout)}},{key:"componentDidUpdate",value:function(e){e.value!==this.props.value&&this.handleTimeUpdate()}},{key:"_createData",value:function(e,t,a){this.__state=e||this.state||{},this.__props=t||this.props||{};this.$prefix;var i=this.__props,s=i.isAppUser,n=i.appMakerHasRead,o=i.text,r=o.messageSending,u=o.messageDelivered,l=void 0,c=void 0,p=r,d=[BASE_CLASS_NAME];s&&d.push(BASE_CLASS_NAME+"--right"),void 0!==this.__state.timeIndicator&&(p=this.__state.timeIndicator,s&&(n?(l="Seen",p=p.toLowerCase()):(p+=".",c=u)));var _=d.join(" ");return Object.assign(this.__state,{anonymousState__temp:_,BASE_CLASS_NAME:BASE_CLASS_NAME,seen:l,timeDisplay:p,delivered:c}),this.__state}}]),o}(),_class2.$$events=[],_class2.$$componentPath="messenger/components/message-status/MessageStatus",_class=_temp2))||_class;exports.default=MessageStatusIndicator,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(MessageStatusIndicator));