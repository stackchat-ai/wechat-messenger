"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _dec,_class,_class2,_temp2,_createClass=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}(),_get=function t(e,n,o){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,n,o)}if("value"in r)return r.value;var i=r.get;return void 0!==i?i.call(o):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../../npm/@tarojs/redux/index.js"),_conversation=require("../../state/actions/conversation.js"),_typing=require("../../state/actions/typing.js"),_appState=require("../../state/actions/app-state.js"),_ui=require("../../state/actions/ui.js"),_dimensions=require("../../state/constants/dimensions.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var BUTTON_CLASS="sc-footer_send-button",ChatInput=(_dec=(0,_index3.connect)(function(t){var e=t.ui.text,n=t.conversation.unreadCount,o=t.config;return{accentColor:o.colors.accentColor,inputPlaceholderText:e.inputPlaceholder,menuItems:o.menuItems,sendButtonText:e.sendButtonText,startingText:e.startingText,unreadCount:n,voiceEnabled:o.voiceConfig.enabled,isVoiceOnly:o.voiceConfig.voiceOnly}}))((_temp2=_class2=function(){function i(){var t,e,o;_classCallCheck(this,i);for(var n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=o=_possibleConstructorReturn(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(r)))).$usedState=["anonymousState__temp","inputPlaceholderText","sendButtonText","isRecording","text","startingText","dispatch","unreadCount"],o.config={component:!0},o.state={isRecording:!1,text:o.props.startingText||""},o.componentWillMount=function(){},o.componentDidUpdate=function(){o.updateStartingText()},o.blur=function(){o._input.blur()},o.onBlur=function(){o.props.dispatch((0,_typing.stopTyping)())},o.checkAndResetUnreadCount=function(t){var e=o.props.dispatch;0<t&&e((0,_conversation.resetUnreadCount)())},o.onInput=function(t){var e=t.target.value;o.updateText(e)},o.updateText=function(t){o.checkAndResetUnreadCount(o.props.unreadCount),o.setState({text:t}),t.trim()&&o.props.dispatch((0,_typing.startTyping)())},o.toggleVoiceRecord=function(){o.props.dispatch((0,_appState.openSpeechRecognitionModal)())},o.onFocus=function(){o.checkAndResetUnreadCount(o.props.unreadCount)},o.onSendMessage=function(t){t.preventDefault();var e=o.state.text,n=o.props.dispatch;o.props.dispatch((0,_appState.setUserIsTyping)(!1)),e.trim()&&(n((0,_conversation.sendMessage)(e)),n((0,_appState.hideUpload)()),o.setState({text:""}))},o.updateStartingText=function(){if(void 0!==o.props.startingText){var t=o.props.startingText;o.props.dispatch((0,_ui.updateText)({startingText:void 0})),o.setState({text:t})}},o._getRows=function(){var t=o._input.rows;o._input.rows=1;var e=Math.ceil((o._input.scrollHeight-_dimensions.FOOTER.BASE_HEIGHT)/_dimensions.FOOTER.INPUT_LINE_HEIGHT)+1;return o._input.rows=t,Math.max(e,1)},o.customComponents=[],_possibleConstructorReturn(o,e)}return _inherits(i,_index.Component),_createClass(i,[{key:"_constructor",value:function(t){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_constructor",this).call(this,t),this.$$refs=[]}},{key:"_createData",value:function(t,e,n){this.__state=t||this.state||{},this.__props=e||this.props||{};this.$prefix;var o=this.__props,r=o.inputPlaceholderText,s=o.sendButtonText,i=[BUTTON_CLASS];this.__state.text.trim()&&i.push(BUTTON_CLASS+"--active");var a=i.join(" ");return Object.assign(this.__state,{anonymousState__temp:a,inputPlaceholderText:r,sendButtonText:s}),this.__state}}]),i}(),_class2.$$events=["onInput","onSendMessage"],_class2.$$componentPath="messenger/components/chat-input/ChatInput",_class=_temp2))||_class;exports.default=ChatInput,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(ChatInput));