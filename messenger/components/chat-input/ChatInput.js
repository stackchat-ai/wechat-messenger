"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _dec,_class,_class2,_temp2,_createClass=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}(),_get=function t(e,n,o){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,n,o)}if("value"in i)return i.value;var r=i.get;return void 0!==r?r.call(o):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../../npm/@tarojs/redux/index.js"),_conversation=require("../../state/actions/conversation.js"),_typing=require("../../state/actions/typing.js"),_appState=require("../../state/actions/app-state.js"),_ui=require("../../state/actions/ui.js"),_dimensions=require("../../state/constants/dimensions.js"),_connectionState=require("../../state/constants/connection-state.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var BUTTON_CLASS="sc-footer_send-button",INPUT_CLASS="sc-footer_input",ChatInput=(_dec=(0,_index3.connect)(function(t){var e=t.appState,n=t.ui.text,o=t.conversation.unreadCount,i=t.config;return{accentColor:i.colors.accentColor,inputPlaceholderText:n.inputPlaceholder,menuItems:i.menuItems,sendButtonText:n.sendButtonText,startingText:n.startingText,unreadCount:o,voiceEnabled:i.voiceConfig.enabled,isVoiceOnly:i.voiceConfig.voiceOnly,connectionState:e.connectionState,isInitialized:e.isInitialized}}))((_temp2=_class2=function(){function r(){var t,e,o;_classCallCheck(this,r);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=o=_possibleConstructorReturn(this,(t=r.__proto__||Object.getPrototypeOf(r)).call.apply(t,[this].concat(i)))).$usedState=["anonymousState__temp","anonymousState__temp2","isInitialized","disableInput","inputPlaceholderText","inputPlaceholderClass","sendButtonText","isRecording","text","startingText","dispatch","unreadCount","connectionState"],o.config={component:!0},o.state={isRecording:!1,text:o.props.startingText||""},o.componentDidUpdate=function(){o.updateStartingText()},o.blur=function(){o._input.blur()},o.onBlur=function(){o.props.dispatch((0,_typing.stopTyping)())},o.checkAndResetUnreadCount=function(t){var e=o.props.dispatch;0<t&&e((0,_conversation.resetUnreadCount)())},o.onInput=function(t){var e=t.target.value;o.updateText(e)},o.onConfirm=function(t){o.updateText(t.target.value),o.onSendMessage(t)},o.updateText=function(t){o.checkAndResetUnreadCount(o.props.unreadCount),o.setState({text:t}),t.trim()&&o.props.dispatch((0,_typing.startTyping)())},o.toggleVoiceRecord=function(){o.props.dispatch((0,_appState.openSpeechRecognitionModal)())},o.onFocus=function(){o.checkAndResetUnreadCount(o.props.unreadCount)},o.onSendMessage=function(t){t&&t.preventDefault();var e=o.state.text,n=o.props.dispatch;o.props.dispatch((0,_appState.setUserIsTyping)(!1)),e.trim()&&(n((0,_conversation.sendMessage)(e)),n((0,_appState.hideUpload)()),o.setState({text:""}))},o.updateStartingText=function(){if(void 0!==o.props.startingText){var t=o.props.startingText;o.props.dispatch((0,_ui.updateText)({startingText:void 0})),o.setState({text:t})}},o._getRows=function(){var t=o._input.rows;o._input.rows=1;var e=Math.ceil((o._input.scrollHeight-_dimensions.FOOTER.BASE_HEIGHT)/_dimensions.FOOTER.INPUT_LINE_HEIGHT)+1;return o._input.rows=t,Math.max(e,1)},o.customComponents=[],_possibleConstructorReturn(o,e)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(t){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,t),this.$$refs=[]}},{key:"_createData",value:function(t,e,n){this.__state=t||this.state||{},this.__props=e||this.props||{};this.$prefix;var o=this.__props,i=o.inputPlaceholderText,s=o.sendButtonText,r=o.isInitialized,a=[BUTTON_CLASS],c=[INPUT_CLASS],p="";this.__state.text.trim()&&a.push(BUTTON_CLASS+"--active");var u=this.__props.connectionState===_connectionState.CONNECTION_STATE.NO_NETWORK,_=this.__props.connectionState===_connectionState.CONNECTION_STATE.DISCONNECTED,l=u||_;l&&(a.push(BUTTON_CLASS+"--disabled"),c.push(INPUT_CLASS+"--disabled"),p="sc-footer_input-placeholder--disabled");var d=r?c.join(" "):null,f=r?a.join(" "):null;return Object.assign(this.__state,{anonymousState__temp:d,anonymousState__temp2:f,isInitialized:r,disableInput:l,inputPlaceholderText:i,inputPlaceholderClass:p,sendButtonText:s}),this.__state}}]),r}(),_class2.$$events=["onInput","onConfirm","onSendMessage"],_class2.$$componentPath="messenger/components/chat-input/ChatInput",_class=_temp2))||_class;exports.default=ChatInput,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(ChatInput));