"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.stopTyping=stopTyping,exports.startTyping=startTyping,exports.cancelTyping=cancelTyping;var _http=require("./http.js"),_http2=_interopRequireDefault(_http),_client=require("../../utils/client.js"),_appState=require("./app-state.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var TYPING_TIMEOUT_MILLIS=1e4,STOP_TYPING_BUFFER_MILLIS=1e3,lastTypingStartEvent=void 0,lastUploadedTypingStartEvent=void 0,typingTimeoutTimer=void 0;function stopTyping(){return function(t,e){clearTimeout(typingTimeoutTimer),typingTimeoutTimer=null;var n=lastTypingStartEvent,i=e(),p=i.config,a=p.appId,r=p.typing,T=i.user;T&&T.id&&r&&r.enabled&&n&&(t((0,_appState.setUserIsTyping)(!1)),setTimeout(function(){lastTypingStartEvent&&n==lastTypingStartEvent&&(lastUploadedTypingStartEvent=lastTypingStartEvent=null,t((0,_http2.default)("POST","/apps/"+a+"/appusers/"+T.id+"/conversation/activity",{activity:{type:"typing:stop"},sender:{type:"endUser",client:(0,_client.getClientInfo)(a)}})))},STOP_TYPING_BUFFER_MILLIS))}}function startTyping(){return function(t,e){var n=e(),i=n.config,p=i.appId,a=i.typing,r=n.user;if(r&&r.id&&a&&a.enabled){lastTypingStartEvent=Date.now(),t((0,_appState.setUserIsTyping)(!0));var T=!!lastUploadedTypingStartEvent,s=Math.abs(lastTypingStartEvent-lastUploadedTypingStartEvent)<=TYPING_TIMEOUT_MILLIS;clearTimeout(typingTimeoutTimer),typingTimeoutTimer=setTimeout(function(){t(stopTyping())},TYPING_TIMEOUT_MILLIS),T&&s||(lastUploadedTypingStartEvent=lastTypingStartEvent,t((0,_http2.default)("POST","/apps/"+p+"/appusers/"+r.id+"/conversation/activity",{activity:{type:"typing:start"},sender:{type:"endUser",client:(0,_client.getClientInfo)(p)}})))}}}function cancelTyping(){clearTimeout(typingTimeoutTimer),lastUploadedTypingStartEvent=lastTypingStartEvent=typingTimeoutTimer=null}