"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateAnalyticsId=void 0,exports.hasInitialized=hasInitialized,exports.on=on,exports.off=off,exports.sendMessage=sendMessage,exports.triggerPostback=triggerPostback,exports.getConversation=getConversation,exports.markAllAsRead=markAllAsRead,exports.setPredefinedMessage=setPredefinedMessage,exports.setDelegate=setDelegate,exports.simulateMessage=simulateMessage,exports.showActivityIndicator=showActivityIndicator,exports.hideActivityIndicator=hideActivityIndicator;var _delegate=require("./utils/delegate.js"),_events=require("./utils/events.js"),_index=require("./state/store/index.js"),_conversation=require("./state/actions/conversation.js"),_conversation2=_interopRequireDefault(_conversation);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function checkInitialization(){if(!_index.store.getState().appState.isInitialized)throw new Error("The messenger needs to initilize before you can call this method.")}function hasInitialized(){return!!_index.store.getState().appState.isInitialized}function on(){return _events.observable.on.apply(_events.observable,arguments)}function off(){return _events.observable.off.apply(_events.observable,arguments)}function sendMessage(e){return Promise.resolve().then(function(){return checkInitialization()}).then(function(){return _index.store.dispatch(_conversation2.default.sendMessage(e))})}function triggerPostback(e,t){return Promise.resolve().then(function(){return checkInitialization()}).then(function(){return _index.store.dispatch(_conversation2.default.sendPostback(e,t))})}function getConversation(){checkInitialization();var e=_index.store.getState().conversation;return e.messages=e.messages.map(function(e){return filterClientProps(e)}),e}function markAllAsRead(){_index.store.dispatch(_conversation2.default.resetUnreadCount())}function setPredefinedMessage(e){_index.store.dispatch(updateText({startingText:e&&e.trim()||""}))}function setDelegate(e){_delegate.delegate.setDelegate(e)}function simulateMessage(e,t){checkInitialization();var n=new Date;_index.store.dispatch(_conversation2.default.addMessage({id:n.getTime().toString(),type:"text",text:e,role:"businessSystem",avatarUrl:t,timestamp:n.getTime()/1e3}))}function showActivityIndicator(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"https://www.gravatar.com/avatar/?d=mm&s=64";_index.store.dispatch(appStateActions.showTypingIndicator({avatarUrl:e,name:""}))}function hideActivityIndicator(){_index.store.dispatch(appStateActions.hideTypingIndicator())}var updateAnalyticsId=exports.updateAnalyticsId=function(){var t=null;return function(e){return e?t===e?t:t=e:t}}();