"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateAnalyticsId=void 0,exports.hasInitialized=hasInitialized,exports.on=on,exports.off=off,exports.sendMessage=sendMessage,exports.triggerPostback=triggerPostback,exports.getConversation=getConversation,exports.markAllAsRead=markAllAsRead,exports.setPredefinedMessage=setPredefinedMessage,exports.setDelegate=setDelegate,exports.simulateMessage=simulateMessage,exports.showActivityIndicator=showActivityIndicator,exports.hideActivityIndicator=hideActivityIndicator;var _delegate=require("./utils/delegate.js"),_events=require("./utils/events.js"),_ui=require("./state/actions/ui.js"),_index=require("./state/store/index.js"),_index2=require("../npm/lodash.omit/index.js"),_index3=_interopRequireDefault(_index2),_conversation=require("./state/actions/conversation.js"),conversationActions=_interopRequireWildcard(_conversation);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function filterClientProps(e){return(0,_index3.default)(e,["_clientId","_clientSent","firstInGroup","firstMessageOfDay","lastInGroup","shouldShowAuthor","shouldShowAvatar"])}function checkInitialization(){if(!_index.store.getState().appState.isInitialized)throw new Error("The messenger needs to initilize before you can call this method.")}function hasInitialized(){return!!_index.store.getState().appState.isInitialized}function on(){return _events.observable.on.apply(_events.observable,arguments)}function off(){return _events.observable.off.apply(_events.observable,arguments)}function sendMessage(e){return Promise.resolve().then(function(){return checkInitialization()}).then(function(){return _index.store.dispatch(conversationActions.sendMessage(e))})}function triggerPostback(e,t){return Promise.resolve().then(function(){return checkInitialization()}).then(function(){return _index.store.dispatch(conversationActions.sendPostback(e,t))})}function getConversation(){checkInitialization();var e=_index.store.getState().conversation;return e.messages=e.messages.map(function(e){return filterClientProps(e)}),e}function markAllAsRead(){_index.store.dispatch(conversationActions.resetUnreadCount())}function setPredefinedMessage(e){_index.store.dispatch((0,_ui.updateText)({startingText:e&&e.trim()||""}))}function setDelegate(e){_delegate.delegate.setDelegate(e)}function simulateMessage(e,t){checkInitialization();var i=new Date;_index.store.dispatch(conversationActions.addMessage({id:i.getTime().toString(),type:"text",text:e,role:"businessSystem",avatarUrl:t,timestamp:i.getTime()/1e3}))}function showActivityIndicator(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"https://www.gravatar.com/avatar/?d=mm&s=64";_index.store.dispatch(appStateActions.showTypingIndicator({avatarUrl:e,name:""}))}function hideActivityIndicator(){_index.store.dispatch(appStateActions.hideTypingIndicator())}var updateAnalyticsId=exports.updateAnalyticsId=function(){var t=null;return function(e){return e?t===e?t:t=e:t}}();