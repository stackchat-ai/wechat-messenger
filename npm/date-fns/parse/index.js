var getTimezoneOffsetInMilliseconds=require("../_lib/getTimezoneOffsetInMilliseconds/index.js"),isDate=require("../is_date/index.js"),MILLISECONDS_IN_HOUR=36e5,MILLISECONDS_IN_MINUTE=6e4,DEFAULT_ADDITIONAL_DIGITS=2,parseTokenDateTimeDelimeter=/[T ]/,parseTokenPlainTime=/:/,parseTokenYY=/^(\d{2})$/,parseTokensYYY=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],parseTokenYYYY=/^(\d{4})/,parseTokensYYYYY=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],parseTokenMM=/^-(\d{2})$/,parseTokenDDD=/^-?(\d{3})$/,parseTokenMMDD=/^-?(\d{2})-?(\d{2})$/,parseTokenWww=/^-?W(\d{2})$/,parseTokenWwwD=/^-?W(\d{2})-?(\d{1})$/,parseTokenHH=/^(\d{2}([.,]\d*)?)$/,parseTokenHHMM=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,parseTokenHHMMSS=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,parseTokenTimezone=/([Z+-].*)$/,parseTokenTimezoneZ=/^(Z)$/,parseTokenTimezoneHH=/^([+-])(\d{2})$/,parseTokenTimezoneHHMM=/^([+-])(\d{2}):?(\d{2})$/;function parse(e,r){if(isDate(e))return new Date(e.getTime());if("string"!=typeof e)return new Date(e);var n=(r||{}).additionalDigits;n=null==n?DEFAULT_ADDITIONAL_DIGITS:Number(n);var a=splitDateString(e),t=parseYear(a.date,n),s=t.year,i=parseDate(t.restDateString,s);if(i){var T,o=i.getTime(),p=0;if(a.time&&(p=parseTime(a.time)),a.timezone)T=parseTimezone(a.timezone)*MILLISECONDS_IN_MINUTE;else{var I=o+p,D=new Date(I);T=getTimezoneOffsetInMilliseconds(D);var l=new Date(I);l.setDate(D.getDate()+1);var d=getTimezoneOffsetInMilliseconds(l)-getTimezoneOffsetInMilliseconds(D);0<d&&(T+=d)}return new Date(o+p+T)}return new Date(e)}function splitDateString(e){var r,n={},a=e.split(parseTokenDateTimeDelimeter);if(r=parseTokenPlainTime.test(a[0])?(n.date=null,a[0]):(n.date=a[0],a[1])){var t=parseTokenTimezone.exec(r);t?(n.time=r.replace(t[1],""),n.timezone=t[1]):n.time=r}return n}function parseYear(e,r){var n,a=parseTokensYYY[r],t=parseTokensYYYYY[r];if(n=parseTokenYYYY.exec(e)||t.exec(e)){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=parseTokenYY.exec(e)||a.exec(e)){var i=n[1];return{year:100*parseInt(i,10),restDateString:e.slice(i.length)}}return{year:null}}function parseDate(e,r){if(null===r)return null;var n,a,t;if(0===e.length)return(a=new Date(0)).setUTCFullYear(r),a;if(n=parseTokenMM.exec(e))return a=new Date(0),t=parseInt(n[1],10)-1,a.setUTCFullYear(r,t),a;if(n=parseTokenDDD.exec(e)){a=new Date(0);var s=parseInt(n[1],10);return a.setUTCFullYear(r,0,s),a}if(n=parseTokenMMDD.exec(e)){a=new Date(0),t=parseInt(n[1],10)-1;var i=parseInt(n[2],10);return a.setUTCFullYear(r,t,i),a}return(n=parseTokenWww.exec(e))?dayOfISOYear(r,parseInt(n[1],10)-1):(n=parseTokenWwwD.exec(e))?dayOfISOYear(r,parseInt(n[1],10)-1,parseInt(n[2],10)-1):null}function parseTime(e){var r,n,a;if(r=parseTokenHH.exec(e))return(n=parseFloat(r[1].replace(",",".")))%24*MILLISECONDS_IN_HOUR;if(r=parseTokenHHMM.exec(e))return n=parseInt(r[1],10),a=parseFloat(r[2].replace(",",".")),n%24*MILLISECONDS_IN_HOUR+a*MILLISECONDS_IN_MINUTE;if(r=parseTokenHHMMSS.exec(e)){n=parseInt(r[1],10),a=parseInt(r[2],10);var t=parseFloat(r[3].replace(",","."));return n%24*MILLISECONDS_IN_HOUR+a*MILLISECONDS_IN_MINUTE+1e3*t}return null}function parseTimezone(e){var r,n;return(r=parseTokenTimezoneZ.exec(e))?0:(r=parseTokenTimezoneHH.exec(e))?(n=60*parseInt(r[2],10),"+"===r[1]?-n:n):(r=parseTokenTimezoneHHMM.exec(e))?(n=60*parseInt(r[2],10)+parseInt(r[3],10),"+"===r[1]?-n:n):0}function dayOfISOYear(e,r,n){r=r||0,n=n||0;var a=new Date(0);a.setUTCFullYear(e,0,4);var t=7*r+n+1-(a.getUTCDay()||7);return a.setUTCDate(a.getUTCDate()+t),a}module.exports=parse;